üìã CONTEXTE DU PROJET : BOT DE CHASSE AU TR√âSOR DOFUS

üéØ OBJECTIF PRINCIPAL
Bot Python automatis√© qui r√©sout les chasses au tr√©sor dans le jeu Dofus en utilisant l'OCR (reconnaissance de texte), l'automatisation de clics et la communication avec le site DofusDB pour trouver les indices.

üèóÔ∏è ARCHITECTURE GLOBALE

Composants Principaux

1. Moteur OCR (EasyOCR)
   - Singleton initialis√© une seule fois au d√©marrage
   - Mod√®les embarqu√©s : craft_mlt_25k.pth, latin_g2.pth
   - GPU d√©sactiv√© en mode packag√© (PyInstaller)
   - Traitement d'image avanc√© pour am√©liorer la reconnaissance (agrandissement 4x, seuillage binaire, inversion)

2. Syst√®me de Calibration
   - Fichier JSON : calibration.json (+ backup .bak)
   - Stocke 20+ coordonn√©es de points/r√©gions d'√©cran
   - Interface GUI d√©di√©e pour recalibrer chaque √©l√©ment individuellement
   - Validation automatique de l'int√©grit√© de la configuration

3. Automatisation PyAutoGUI
   - Contr√¥le souris/clavier
   - Captures d'√©cran cibl√©es
   - Basculement entre Dofus et Chrome
   - Presse-papiers pour les commandes /travel

4. Interface Utilisateur
   - Mode CLI : --calibrate, --export, --import, --validate, --reset
   - Mode GUI (Tkinter) : Interface compl√®te avec logs en temps r√©el, contr√¥les d√©marrage/arr√™t, gestion Phorreur, mode r√©cup√©ration

üîÑ FLUX D'EX√âCUTION D√âTAILL√â

√âtape 1 : Initialisation
Chargement config ‚Üí Initialisation OCR ‚Üí Capture position de d√©part

√âtape 2 : Boucle principale (pour chaque indice)
1. Survol indice #N dans Dofus ‚Üí Capture infobulle
2. OCR de l'infobulle ‚Üí Extraction √©l√©ment + direction
3. Correction fuzzy matching (HINT_LIST de 300+ indices)
4. Gestion sp√©ciale "Phorreur" ‚Üí Pause manuelle
5. Envoi donn√©es √† DofusDB (X, Y, direction, √©l√©ment)
   ‚ö†Ô∏è OPTIMISATION : Seule la direction est retap√©e      
      apr√®s le 1er indice (sauf Phorreur/r√©cup√©ration)
6. R√©cup√©ration commande /travel depuis presse-papiers
7. Validation stricte (format + coordonn√©es)
8. Envoi /travel dans chat Dofus ‚Üí Clic "Oui"
9. Boucle attente arriv√©e (OCR position toutes les 2s)
   ‚ö†Ô∏è D√âTECTION ERREUR SIGNE "-" : Compteur 5 tentatives
      Si m√™me position ‚â•5x ‚Üí Consid√©r√© arriv√©
10. Validation jalon (clic sur coche) ‚Üí Indice suivant

√âtape 3 : Fin d'√©tape
Indice vide d√©tect√© ‚Üí Clic "Valid√©e" ‚Üí Nouvelle √©tape ‚Üí Boucle recommence

üìê DONN√âES DE CALIBRATION (20 √©l√©ments)

Points de clic (13)
- open_dofus/open_chrome : Ic√¥nes barre des t√¢ches
- open_chasse_tab : Onglet DofusDB
- dofus_chat_input : Champ de saisie Dofus
- input_pos_x/input_pos_y : Champs X/Y sur DofusDB
- dofus_ui_deadpoint/chasse_deadpoint : Points neutres pour d√©s√©lection
- chasse_element_input/chasse_element_option : Recherche d'indice sur site
- hint_hover_first/hint_click_first : 1√®re ligne d'indice Dofus
- travel_confirm_button : Bouton "Oui" de /travel

R√©gions de capture (3)
- starting_pos_region : Position de d√©part (HUD Dofus)
- current_pos_region : Position actuelle (HUD Dofus)
- hint_region_first : Infobulle 1er indice

Directions (4)
- chasse_direction_buttons.nord/est/ouest/sud : Boutons DofusDB

Param√®tres sp√©ciaux (2)
- row_step : Espacement vertical entre lignes d'indices (pixels)
- validate_click_offset_y : Offset pour clic "Valid√©e" (-4 par d√©faut)

üß† LOGIQUE AVANC√âE

OCR Optimis√©
- Coordonn√©es : Agrandissement 4x, LANCZOS4, seuillage OTSU, inversion couleur
- Corrections : O‚Üí0, S‚Üí5, l‚Üí1, Z‚Üí2, B‚Üí8, q/g‚Üí9
- Gestion tirets : Normalisation Unicode (‚Äî, ‚Äì, ‚àí ‚Üí -)

Extraction indices
- M√©thode 1 : Regex [\[(]\s*([^\]\)]+?)\s*[\]\)] (tol√®re erreurs OCR)
- M√©thode 2 : Split sur "jusqu'√†/jusqu'"
- M√©thode 3 : Suppression pattern "dirigez-vous..."
- Correction finale : Fuzzy matching (fuzzywuzzy) contre HINT_LIST (score ‚â•45)

Optimisations Performances
- ‚úÖ 1er indice/Phorreur/R√©cup√©ration : Tape X, Y, direction, √©l√©ment
- ‚úÖ Indices suivants : Tape UNIQUEMENT direction + √©l√©ment (DofusDB garde X/Y en m√©moire)
- ‚úÖ D√©tection erreur "-" : Si position identique ‚â•5x (signes diff√©rents) ‚Üí Valid√©

Gestion Phorreur
D√©tection "Phorreur" dans indice
‚Üí Signal sonore + pause
‚Üí GUI : Active bouton "Continuer" | CLI : Attend Entr√©e
‚Üí Validation jalon + actualisation position actuelle
‚Üí Flag is_first_hint=True (retape tout sur DofusDB)

Mode R√©cup√©ration
Permet de reprendre une chasse interrompue
‚Üí Input : X, Y derni√®re position, num√©ro d'indice √† traiter
‚Üí Flag is_first_hint=True pour resynchroniser DofusDB

üé® INTERFACE GUI (Tkinter)

Fonctionnalit√©s
- Logs en temps r√©el : Queue thread-safe, redirection stdout
- √âtats visuels : Blanc (idle) ‚Üí Vert (running) ‚Üí Rouge (stopped)
- Contr√¥les : Lancer/Arr√™ter, Continuer (Phorreur), Calibration
- Options : Toujours au-dessus, mode r√©cup√©ration
- Gestionnaire Calibration : TreeView √©ditable, export/import/reset

S√©curit√©
- Stop thread-safe avec threading.Event
- Validation stricte commandes /travel
- Timeout 15s chargement carte
- Gestion erreurs OCR avec fallbacks

üõ†Ô∏è D√âPENDANCES CRITIQUES
- easyocr         # OCR
- opencv-python   # Traitement image
- pyautogui       # Automatisation
- pyperclip       # Presse-papiers
- fuzzywuzzy      # Matching flou
- python-Levenshtein  # Acc√©l√©ration fuzzy
- numpy           # Traitement matriciel
- pynput          # Calibration (souris/clavier)
- tkinter         # GUI (inclus Python)

üìå POINTS D'ATTENTION POUR L'IA

1. Pr√©cision calibration : Erreur 1 pixel = √©chec total
2. R√©solution Dofus : Param√®tres recommand√©s dans show_startup_message()
3. Robustesse OCR : Traitement image CRUCIAL pour "‚àí" (minus Unicode)
4. Thread-safety : Toutes actions pyautogui doivent v√©rifier stop_event
5. √âtat DofusDB : Le site garde X/Y en m√©moire entre recherches
6. Validation stricte : JAMAIS envoyer commande /travel invalide
